---
title: redis缓存
type: categories
copyright: true
date: 2022-03-10 23:07:19
tags:
    - 数据库
    - redis
categories: [数据库, redis]
keywords: redis
---

<script type="text/javascript" src="/js/src/bai.js"></script>


## redis关于缓存的一些问题
&emsp;&emsp; 缓存的作用：前台发送获取数据的请求，后台先查询缓存是否有需要的数据，存在则直接返回结果，不存在则从数据库中查询，查询到数据则更新缓存，返回结果，没有查询到返回定义的状态信息；

&emsp;&emsp;业务场景中，当我们需要设计一个缓存系统时，不得不考虑缓存所面对的一些问题
- 缓存穿透
- 缓存击穿
- 缓存雪崩
<!-- more -->
### 缓存穿透
- 描述：

&emsp;&emsp;缓存穿透是指缓存和数据库中都没有数据，用户不断的发送请求，由于缓存是不命中被动写入的，而出于容错考虑，存储层数据库查不到数据则不写入缓存，这将导致每个请求都会进行数据库的查询，失去了缓存的意义；
- 场景：

&emsp;&emsp; 可能会有人利用不存在的key频繁的请求数据，导致数据库压力过大甚至直接挂掉；

- 解决方案：

&emsp;&emsp; 1、接口层进行key的校验，比如用户鉴权校验，用户ID校验；能够确定不存在key的直接进行拦截；

&emsp;&emsp; 2、对不存在的key直接设置空值，设置过期时间，避免用户短时间用同一个key频繁请求；

&emsp;&emsp; 3、[使用布隆过滤器](https://blog.leslie168.com/数据库/redis/python版布隆过滤器/)


### 缓存击穿
- 描述：

&emsp;&emsp; 缓存击穿是指缓存中没有的数据但是存储层数据库中有的数据，一般出现的情况是缓存时间到期了，这时由于并发用户请求太多，同时读取缓存没有数据，又同时去查询数据库，导致数据库压力过大；

- 解决方案：

&emsp;&emsp; 1、设置热点数据不过期或加大过期时间；

&emsp;&emsp; 2、接口限流，熔断，降级；重要的接口做好限流策略，防止用户恶意刷接口；当接口中的某些服务不可用时，进行熔断，失败快速返回机制；

&emsp;&emsp; 3、加互斥锁；第一个读取缓存的请求发现没有数据则获取锁，查询数据库更新缓存后释放锁并返回结果，则其他线程请求获取锁失败则等待并重新从缓存中读取数据；


### 缓存雪崩

- 描述：

&emsp;&emsp; 缓存雪崩是指缓存中的数据大批量到过期时间，而查询数据量过大，引起数据库压力过大甚至宕机；和缓存击穿的区别在于缓存击穿是并发查询同一条数据，缓存雪崩是大批量不同数据到过期时间失效从而查询数据库；

- 解决方案：

&emsp;&emsp; 1、缓存数据的过期时间随机设定，防止同一时间大批量的数据过期失效；

&emsp;&emsp; 2、分布式部署缓存的话，将热点数据均匀分布在不同的缓存数据库中；

&emsp;&emsp; 3、设置热点数据不过期；
