---
title: python中闭包和装饰器
type: categories
copyright: true
date: 2020-01-02 11:09:20
tags:
	- python
	- 基础
categories: [python, 基础]
---
## 1.闭包
### 闭包的理解
   *闭包* 是引用了变量的函数，这个被引用的自由变量将和这个函数一同存在，即使离开了创造这个变量的环境也不例外。所以，*闭包* 是由函数和与其相关的引用环境组合而成的实体。简单来说，*闭包* 就是数据和功能的结合。
<!--more-->
### 闭包的优缺点
 **优点：** 可以提高代码的可复用性
 **缺点：** 由于闭包是引用了外部函数的局部变量，导致外部函数的局部变量没有及时释放，消耗内存。

 
## 2.装饰器
### 什么是装饰器？
装饰器本质上也还是一个python函数，它可以让其他函数在不需要的做任何代码变动的前提下，增加额外的功能，装饰器的返回值也是一个函数对象。装饰器的应用场景主要是一些有切面需求的场景，例如：插入日志，性能测试，事务处理，缓存，权限校验等。通过装饰器，我们可以抽离大量与函数功能本身无关的雷同代码并重复应用。
### 装饰器的功能

 - 引入日志
 - 函数执行时间统计
 - 执行函数前的预备处理
 - 执行函数后的清理功能
 - 权限校验等场景
 - 缓存
 
### 一个函数同时被多个装饰器装饰的执行顺序
 一个函数如果同时被多个装饰器装饰，由紧靠函数的装饰器先对函数进行装饰，然后返回的结果在给外层的装饰器去执行装饰，依次类推直到所有装饰器都装饰完成，最后会得到一个函数，在执行这个函数的时候，会先执行最外层装饰器的内容，在执行里面装饰器的内容。这个过程有点像我们给一个精美的物品进行一层一层的包装，在包装的时候是从最里面一层层往往包装，拆开的时候又是从外面一层层的拆开。
### 对比函数、闭包、对象在作为实参时的区别
**函数作为实参**  如果没有()会作为一个功能传入到另一个函数，如果有()，则会传入这个函数的执行结果即返回值
**闭包作为实参**  会传入较为复杂的功能和数据
**对象作为实参**  会传入最为复杂的功能和数据，但是对象占用的空间比较大，传递的是很多的功能和数据
### 通用的装饰器

```python
def set_fun(fun):
	def call_fun(*args, **kwargs):
		print("----这是前面的功能---权限验证---")
		ret = fun(*args, **kwargs)
		print("----这是后面的功能---log日志功能---")
		return ret
	return call_fun
```
![这里写图片描述](https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTgwMTI1MjI0NjA4NDQ2?x-oss-process=image/format,png)


 

