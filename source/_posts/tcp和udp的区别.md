---
title: tcp和udp的区别
type: categories
copyright: true
date: 2022-03-03 14:44:07
tags:
    -python
categories: [python, 基础]
keywords: [TCP, UDP]
top: 79
---

<script type="text/javascript" src="/js/src/bai.js"></script>

## tcp的特点
- 面向连接， 数据发送之前先建立连接，那么这样能保证对方的ip地址是有效的
- 应答机制， 对方收到数据以后会进行回复
- 超时重传， 数据在发送过程中，如果对方一直没有回复，那么会隔一段时间再次发送数据，如果对方一直没有回复，那么就会认为对方掉线了。
- 错误校验， 发送的数据和接收的数据会进行比较，如果数据不一致，会删除数据重新发送，如果是重复数据也会删除。
- 流量控制， 如果接收方没有及时接收数据，那么发送方就不会一直发送数据，比如先发1M数据，等接收方开始接收数据的时候才开始继续发送数据。
<!-- more -->

## tcp和udp的对比
- tcp面向连接，udp不面向连接，直接发送数据
- tcp能保证数据的准确性和有效性，udp保证不了
- tcp有超时重传机制，udp没有
- tcp有流量控制（果接收方没有及时接收数据，那么发送方就不会一直发送数据，），udp没有
- tcp因为需要建立连接，需要资源开销，udp 不需要建立连接，没有太多资源开销，那么这样tcp的传输数据不如udp
- tcp不适合做广播，udp适合做广播

## tcp注意点
- tcp服务器一般情况下都需要绑定，否则客户端找不到这个服务器

- tcp客户端一般不绑定，因为是主动链接服务器，所以只要确定好服务器的ip、port等信息就好，本地客户端可以随机
- tcp服务器中通过listen可以将socket创建出来的主动套接字变为被动的，这是做tcp服务器时必须要做的
- 当客户端需要链接服务器时，就需要使用connect进行链接，udp是不需要链接的而是直接发送，但是tcp必须先链接，只有链接成功才能通信
- 当一个tcp客户端连接服务器时，服务器端会有1个新的套接字，这个套接字用来标记这个客户端，单独为这个客户端服务
- listen后的套接字是被动套接字，用来接收新的客户端的链接请求的，而accept返回的新套接字是标记这个新客户端的
- 关闭listen后的套接字意味着被动套接字关闭了，会导致新的客户端不能够链接服务器，但是之前已经链接成功的客户端正常通信。
- 关闭accept返回的套接字意味着这个客户端已经服务完毕
- 当客户端的套接字调用close后，服务器端会recv解堵塞，并且返回的长度为0，因此服务器可以通过返回数据的长度来区别客户端是否已经下线


## tcp的三次握手和四次挥手
### 三次握手
- 第一次握手：客户端发送syn包(syn=x)到服务器，并进入SYN_SEND状态，等待服务器确认；
- 第二次握手：服务器收到syn包，必须确认客户的SYN（ack=x+1），同时自己也发送一个SYN包（syn=y），即SYN+ACK包，此时服务器进入SYN_RECV状态；
- 第三次握手：客户端收到服务器的SYN＋ACK包，向服务器发送确认包ACK(ack=y+1)，此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手。

### 四次挥手
- 第一次挥手：主动关闭方发送一个FIN，用来关闭主动方到被动关闭方的数据传送，也就是主动关闭方告诉被动关闭方：我已经不 会再给你发数据了(当然，在fin包之前发送出去的数据，如果没有收到对应的ack确认报文，主动关闭方依然会重发这些数据)，但是，此时主动关闭方还可 以接受数据。
- 第二次挥手：被动关闭方收到FIN包后，发送一个ACK给对方，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号）。
- 第三次挥手：被动关闭方发送一个FIN，用来关闭被动关闭方到主动关闭方的数据传送，也就是告诉主动关闭方，我的数据也发送完了，不会再给你发数据了。
- 第四次挥手：主动关闭方收到FIN后，发送一个ACK给被动关闭方，确认序号为收到序号+1，至此，完成四次挥手。

